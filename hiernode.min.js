var HierNodeLib={Version:function(){return"v0.1.14"},HierNode:function(b){"undefined"==typeof b&&(b={});b._hnPrevNode=null;b._hnNextNode=null;b._hnIndent=0;b.PrevNode=function(){return this._hnPrevNode};b.NextNode=function(){return this._hnNextNode};b.Indent=function(){return this._hnIndent};b.CloneNode=function(){var a=this._hnPrevNode,c=this._hnNextNode;this._hnNextNode=this._hnPrevNode=null;var d=HierNodeLib.CloneObject(this);this._hnPrevNode=a;this._hnNextNode=c;return d};b.FindRelative=function(a){for(var c=
this._hnPrevNode,d=this._hnNextNode,b=this,e=this,g=null;;){if("PrevNode"===a)return this._hnPrevNode;if("NextNode"===a)return this._hnNextNode;if("FirstNode"===a){if(null===c)return this;if(null===c._hnPrevNode)return c;c=c._hnPrevNode}else if("LastNode"===a){if(null===d)return this;if(null===d._hnNextNode)return d;d=d._hnNextNode}else if("RootNode"===a){if(null===c)return b;c._hnIndent<b._hnIndent&&(b=c);c=c._hnPrevNode}else if("ParentNode"===a){if(null===c)break;if(c._hnIndent<this._hnIndent)return c;
c=c._hnPrevNode}else if("PrevSibNode"===a){if(null===c)break;if(c._hnIndent<this._hnIndent)break;if(c._hnIndent===this._hnIndent)return c;c=c._hnPrevNode}else if("NextSibNode"===a){if(null===d)break;if(d._hnIndent<this._hnIndent)break;if(d._hnIndent===this._hnIndent)return d;d=d._hnNextNode}else if("FirstSibNode"===a){if(null===c||c._hnIndent<this._hnIndent)return e;c._hnIndent===this._hnIndent&&(e=c);c=c._hnPrevNode}else if("LastSibNode"===a){if(null===d||d._hnIndent<this._hnIndent)return e;d._hnIndent===
this._hnIndent&&(e=d);d=d._hnNextNode}else if("FirstChildNode"===a){if(null===d)break;if(d._hnIndent<=this._hnIndent)break;if(d._hnIndent===this._hnIndent+1)return d;d=d._hnNextNode}else if("LastChildNode"===a){if(null===d||d._hnIndent<=this._hnIndent)return g;d._hnIndent===this._hnIndent+1&&(g=d);d=d._hnNextNode}else if("FirstDescNode"===a){if(d&&d._hnIndent>this._hnIndent)return d;break}else if("LastDescNode"===a){if(null===d||d._hnIndent<=this._hnIndent)return g;d._hnIndent>this._hnIndent&&(g=
d);d=d._hnNextNode}else break}return null};b.FindFirst=function(){return this.FindRelative("FirstNode")};b.FindLast=function(){return this.FindRelative("LastNode")};b.FindRoot=function(){return this.FindRelative("RootNode")};b.FindParent=function(){return this.FindRelative("ParentNode")};b.FindPrevSibling=function(){return this.FindRelative("PrevSibNode")};b.FindNextSibling=function(){return this.FindRelative("NextSibNode")};b.FindFirstSibling=function(){return this.FindRelative("FirstSibNode")};
b.FindLastSibling=function(){return this.FindRelative("LastSibNode")};b.FindFirstChild=function(){return this.FindRelative("FirstChildNode")};b.FindLastChild=function(){return this.FindRelative("LastChildNode")};b.FindFirstDescendent=function(){return this.FindRelative("FirstDescNode")};b.FindLastDescendent=function(){return this.FindRelative("LastDescNode")};b.VisitNodes=function(a,c,d){"undefined"==typeof d&&(d=!1);var b,e,g=null;if("AllNodes"==c)b="FirstNode",e="NextNode";else if("PrevNodes"==
c)e=b="PrevNode";else if("NextNodes"==c)e=b="NextNode";else if("ParentNodes"==c)e=b="ParentNode";else if("SiblingNodes"==c)b="FirstSibNode",e="NextSibNode";else if("PrevSibNodes"==c)e=b="PrevSibNode";else if("NextSibNodes"==c)e=b="NextSibNode";else if("ChildNodes"==c)b="FirstChildNode",e="NextSibNode",g=!0;else if("DecendentNodes"==c)b="FirstChildNode",e="NextNode",g=!0;else throw Error("Unknown VisitationType ["+c+"].");if(a.Init&&!a.Init(this,a,c,d)||d&&!a.Visit(this))return a;for(c=this.FindRelative(b);c&&
!(g&&c._hnIndent<=this._hnIndent)&&a.Visit(c);)c=c.FindRelative(e);return a};b.VisitAll=function(a){return this.VisitNodes(a,"PrevNodes",!1)};b.VisitPrevious=function(a,c){return this.VisitNodes(a,"PrevNodes")};b.VisitNext=function(a,c){return this.VisitNodes(a,"NextNodes")};b.VisitParents=function(a,c){return this.VisitNodes(a,"ParentNodes")};b.VisitSiblings=function(a){return this.VisitNodes(a,"SiblingNodes",!1)};b.VisitPreviousSiblings=function(a,c){return this.VisitNodes(a,"PrevSibNodes")};b.VisitNextSiblings=
function(a,c){return this.VisitNodes(a,"NextSibNodes")};b.VisitChildren=function(a,c){return this.VisitNodes(a,"ChildNodes")};b.VisitDescendents=function(a,c){return this.VisitNodes(a,"DecendentNodes")};b.ChildCount=function(){return this.VisitNodes(new HierNodeLib.CountingVisitor,"ChildNodes",!1).Count};b.Children=function(a){"undefined"==typeof a&&(a=!1);return this.VisitNodes(new HierNodeLib.CollectingVisitor,"ChildNodes",a).Nodes};b.Child=function(a){return this.VisitNodes(new HierNodeLib.IndexSelectorVisitor(a),
"ChildNodes",!1).Node};b.SearchChildren=function(a,c,b){"undefined"==typeof b&&(b=!1);return this.VisitNodes(new HierNodeLib.PropertySearchVisitor(a,c),"ChildNodes",b).Nodes};b.SearchFirstChild=function(a,c,b){"undefined"==typeof b&&(b=!1);return this.VisitNodes(new HierNodeLib.PropertySearchFirstVisitor(a,c),"ChildNodes",b).Node};b.DescendentCount=function(){return this.VisitNodes(new HierNodeLib.CountingVisitor,"DecendentNodes",!1).Count};b.Descendents=function(a){"undefined"==typeof a&&(a=!1);
return this.VisitNodes(new HierNodeLib.CollectingVisitor,"DecendentNodes",a).Nodes};b.SearchDescendents=function(a,c,b){"undefined"==typeof b&&(b=!1);return this.VisitNodes(new HierNodeLib.PropertySearchVisitor(a,c),"DecendentNodes",b).Nodes};b.SearchFirstDescendent=function(a,c,b){"undefined"==typeof b&&(b=!1);return this.VisitNodes(new HierNodeLib.PropertySearchFirstVisitor(a,c),"DecendentNodes",b).Node};b.Link=function(a,c){if(this._hnPrevNode||this._hnNextNode)throw Error("This node is already linked.");
this._hnPrevNode=a;this._hnNextNode=c;this._hnPrevNode&&(this._hnPrevNode._hnNextNode=this);this._hnNextNode&&(this._hnNextNode._hnPrevNode=this);return this};b.Unlink=function(){var a=this._hnPrevNode,c=this._hnNextNode;this._hnNextNode=this._hnPrevNode=null;a&&(a._hnNextNode=c);c&&(c._hnPrevNode=a);return this};b.AddChild=function(a,c){"undefined"==typeof a&&(a={});"undefined"==typeof c&&(c=-1);a=HierNodeLib.HierNode(a);for(var b=this,f=this._hnNextNode;f;){if(f._hnIndent===this._hnIndent+1){if(0===
c)return a.Link(b,f),a._hnIndent=this._hnIndent+1,a;c--}else if(f._hnIndent<=this._hnIndent)return a.Link(b,f),a._hnIndent=this._hnIndent+1,a;b=f;f=f._hnNextNode}a.Link(b,null);a._hnIndent=this._hnIndent+1;return a};b.AddChildren=function(a){if(0==a.length)return this;for(var c=this,b=this,f=this._hnIndent,e,g=0;g<a.length;g++){e=a[g]._hnIndent||0;e==f?(c=c.FindRelative("ParentNode"),f=c._hnIndent):e>f?(c=b,f=b._hnIndent):e<f&&(c=c.FindRelative("ParentNode"),f=c._hnIndent);if(!c)break;b=c.AddChild(a[g])}return this};
b.RemoveChild=function(a){a=this.VisitNodes(new HierNodeLib.IndexSelectorVisitor(a),"ChildNodes").Node;if(!a)return null;var c=a.FindRelative("LastDescNode");if(c){if(a._hnPrevNode._hnNextNode=c._hnNextNode)c._hnNextNode._hnPrevNode=a._hnPrevNode}else a._hnPrevNode._hnNextNode=null;a._hnPrevNode=null;a._hnNextNode=null;return a};b.RemoveChildren=function(){var a=this.FindRelative("LastDescNode");a&&(a._hnPrevNode=this,this._hnNextNode=a._hnNextNode)&&(a._hnNextNode._hnPrevNode=this)};b.TextGraph=
function(a,c,b,f){"undefined"==typeof c&&(c=!1);"undefined"==typeof b&&(b="\t");"undefined"==typeof f&&(f="\n");var e="";c&&(e=this[a]);for(var g=this._hnIndent,h=this._hnNextNode;h&&!(h._hnIndent<=g);){var e=e+f,k=1;for(c||k++;k<=h._hnIndent-g;k++)e+=b;e+=h[a];h=h._hnNextNode}return e};b.TextPath=function(a,b,d){"undefined"==typeof b&&(b=!0);"undefined"==typeof d&&(d="/");var f=this.VisitNodes(new HierNodeLib.CollectingVisitor,"ParentNodes",!0).Nodes,e=f.length-1;b||e--;b="";for(var g=0;g<=e;g++)b=
d+f[g][a]+b;return b};b.FindPath=function(a,b,d,f){"undefined"==typeof f&&(f="/");for(d=this;d&&0<a.length;){for(;0==a.indexOf(f);)a=a.substr(f.length);if(0<a.length){var e=a.indexOf(f);0>e&&(e=a.length);var g=a.substr(0,e);a=a.substr(e);d=d.VisitNodes(new HierNodeLib.PropertySearchFirstVisitor(b,g),"ChildNodes").Node}}return d};return b},TextNode:function(b){"undefined"==typeof b&&(b="");b=HierNodeLib.HierNode({Text:b});b.AddChildText=function(a,b){"undefined"==typeof a&&(a="");return this.AddChild(HierNodeLib.TextNode(a),
b)};return b},CloneObject:function(b){var a;if(null==b||"object"!=typeof b)return b;if(b instanceof Date)return a=new Date,a.setTime(b.getTime()),a;if(b instanceof Array){a=[];for(var c=0,d=b.length;c<d;c++)a[c]=HierNodeLib.CloneObject(b[c]);return a}if(b instanceof Object){a={};for(c in b)b.hasOwnProperty(c)&&(a[c]=HierNodeLib.CloneObject(b[c]));return a}throw Error("Unable to copy obj! Its type isn't supported.");},NullVisitor:function(){this.Init=function(b,a,c,d){return!0};this.Visit=function(b){return!0}},
CountingVisitor:function(){this.Count=0;this.Visit=function(b){this.Count++;return!0}},CollectingVisitor:function(b){"undefined"==typeof b&&(b=!1);this.Nodes=[];this.RootIndent=0;this.Init=function(a,b,d,f){this.RootIndent=a._hnIndent;return!0};this.Visit=function(a){var c=a;b&&(c=c.CloneNode(),c=HierNodeLib.HierNode(c),c._hnIndent=a._hnIndent-this.RootIndent);this.Nodes.push(c);return!0}},IndexSelectorVisitor:function(b){this.Index=b;this.Count=0;this.Node=null;this.Visit=function(a){this.Count++;
return this.Count>this.Index?(this.Node=a,!1):!0}},PropertySearchVisitor:function(b,a,c){"undefined"==typeof c&&(c=0);this.PropertyName=b;this.PropertyValue=a;this.MaxResults=c;this.Nodes=[];this.Visit=function(c){if(this.MaxResults&&this.Nodes.length>=this.MaxResults)return!1;c[b]===a&&this.Nodes.push(c);return!0}},PropertySearchFirstVisitor:function(b,a){this.PropertyName=b;this.PropertyValue=a;this.Node=null;this.Visit=function(c){return c[b]==a?(this.Node=c,!1):!0}}};
"undefined"!=typeof window&&(window.HierNodeLib=HierNodeLib);"undefined"!=typeof window&&(window.HierNode=HierNodeLib.HierNode);"undefined"!=typeof window&&(window.TextNode=HierNodeLib.TextNode);"undefined"!=typeof exports&&(exports.HierNodeLib=HierNodeLib);"undefined"!=typeof exports&&(exports.HierNode=HierNodeLib.HierNode);"undefined"!=typeof exports&&(exports.TextNode=HierNodeLib.TextNode);
